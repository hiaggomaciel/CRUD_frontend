{"ast":null,"code":"var _jsxFileName = \"/home/hiaggomaciel/Documentos/CRUD_frontend/src/contexts/auth.js\",\n  _s = $RefreshSig$();\nimport { createContext, useEffect } from \"react\";\nimport { useState } from 'react';\nimport { useNavigate } from \"react-router-dom\";\nimport { api, createSession } from '../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction parseJwt(token) {\n  var base64Url = token.split('.')[1];\n  var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n  var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function (c) {\n    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n  }).join(''));\n  return JSON.parse(jsonPayload);\n}\n;\nexport const AuthContext = /*#__PURE__*/createContext();\nexport const AuthProvider = _ref => {\n  _s();\n  let {\n    children\n  } = _ref;\n  const navigate = useNavigate();\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  useEffect(() => {\n    const recoverdUser = localStorage.getItem(\"user_id\");\n    if (recoverdUser) {\n      setUser(JSON.parse(recoverdUser));\n    }\n    setLoading(false);\n  }, []);\n  const login = async (email, password) => {\n    const response = await createSession(email, senha);\n    const token = response.data.access;\n    const loggedUserId = parseJwt(token).user_id;\n    console.log(loggedUserId, token);\n    localStorage.setItem(\"user_id\", JSON.stringify(loggedUserId));\n    localStorage.setItem(\"token\", token);\n    api.defaults.headers.Authorization = `Bearer ${token}`;\n    setUser(loggedUserId);\n    navigate(\"/dashboard\");\n  };\n  const logout = () => {\n    console.log(\"Logout\");\n    localStorage.removeItem(\"user_id\");\n    localStorage.removeItem(\"token\");\n    api.defaults.headers.Authorization = null;\n    setUser(null);\n    navigate('/entrar');\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      authenticated: !!user,\n      user,\n      loading,\n      login,\n      logout\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 72,\n    columnNumber: 9\n  }, this);\n};\n_s(AuthProvider, \"bMs6vkxBNdJdvAQTZITyVwx4nss=\", false, function () {\n  return [useNavigate];\n});\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["createContext","useEffect","useState","useNavigate","api","createSession","parseJwt","token","base64Url","split","base64","replace","jsonPayload","decodeURIComponent","window","atob","map","c","charCodeAt","toString","slice","join","JSON","parse","AuthContext","AuthProvider","children","navigate","user","setUser","loading","setLoading","recoverdUser","localStorage","getItem","login","email","password","response","senha","data","access","loggedUserId","user_id","console","log","setItem","stringify","defaults","headers","Authorization","logout","removeItem","authenticated"],"sources":["/home/hiaggomaciel/Documentos/CRUD_frontend/src/contexts/auth.js"],"sourcesContent":["import { createContext, useEffect } from \"react\";\nimport { useState } from 'react';\nimport { useNavigate } from \"react-router-dom\";\nimport { api, createSession } from '../services/api'\n\nfunction parseJwt (token) {\n    var base64Url = token.split('.')[1];\n    var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n    var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {\n        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n    }).join(''));\n\n    return JSON.parse(jsonPayload);\n};\n\n\n\nexport const AuthContext = createContext()\n\nexport const AuthProvider = ({children}) => {\n    const navigate = useNavigate()\n    const [user, setUser] = useState(null);\n    const [loading, setLoading] = useState(true)\n\n    useEffect(() => {\n        const recoverdUser = localStorage.getItem(\"user_id\")\n\n        if (recoverdUser){\n            setUser(JSON.parse(recoverdUser))\n            \n        }\n\n        setLoading(false)\n\n    }, [])\n  \n    const login = async (email, password) => {\n        const response = await createSession(email, senha)\n        \n\n        const token = response.data.access\n\n        const loggedUserId = parseJwt(token).user_id\n\n        console.log(loggedUserId, token)\n\n        localStorage.setItem(\"user_id\", JSON.stringify(loggedUserId))\n        localStorage.setItem(\"token\", token)\n\n        api.defaults.headers.Authorization = `Bearer ${token}`\n\n\n        \n        setUser(loggedUserId)\n        navigate(\"/dashboard\")\n        \n        };\n\n  \n    const logout = () => {\n      console.log(\"Logout\")\n      localStorage.removeItem(\"user_id\")\n      localStorage.removeItem(\"token\")\n\n\n      api.defaults.headers.Authorization = null\n      setUser(null)\n      navigate('/entrar')\n    };\n    return (\n\n        <AuthContext.Provider \n            value={{authenticated: !!user, user, loading, login, logout}} > \n            {children}\n        </AuthContext.Provider>\n    )\n} "],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}